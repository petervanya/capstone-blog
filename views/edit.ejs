<%- include('partials/header') %>

<div class="container">
  <h1>Edit Article</h1>
  
  <% if (typeof error !== 'undefined' && error) { %>
    <div class="error-message">
      <p><%= error %></p>
    </div>
  <% } %>
  
  <form action="/update/<%= post.id %>" method="POST" class="post-form">
    <div class="form-group">
      <label for="title">Article Title:</label>
      <input type="text" id="title" name="title" value="<%= post.title %>" required>
    </div>
    
    <div class="form-group">
      <label for="content">Article Content:</label>
      <textarea id="content" name="content" rows="12" required><%= post.content %></textarea>
    </div>
    
    <div class="form-actions">
      <button type="submit" class="btn btn-primary">Update Article</button>
      <a href="/" class="btn btn-secondary">Cancel</a>
    </div>
  </form>

  <div class="preview-section">
    <h2>Live Preview</h2>
    <div id="markdown-preview" class="markdown-preview"></div>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/dompurify@3.0.9/dist/purify.min.js"></script>
<script>
  const textarea = document.getElementById('content');
  const preview = document.getElementById('markdown-preview');

  function updatePreview() {
    const raw = textarea.value || '';
    const html = marked.parse(raw);
    preview.innerHTML = DOMPurify.sanitize(html);
  }

  textarea.addEventListener('input', updatePreview);
  document.addEventListener('DOMContentLoaded', updatePreview);
</script>

<%- include('partials/footer') %>